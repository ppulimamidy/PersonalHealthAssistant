# context.md

# VitaSense PPA â€“ Microservices & Agentic Architecture Specification

---

## ğŸ§  Purpose

This document defines the architecture, responsibilities, API endpoints, and agentic capabilities of the **VitaSense Personal Physician Assistant (PPA)** platform. It is intended for backend engineers implementing microservices and agentic services using Python (FastAPI), PostgreSQL, and optional AI modules.

---

## ğŸ”§ Technology Stack

- **API Framework**: FastAPI (Python 3.10+)
- **Database**: PostgreSQL with `pgvector` extension
- **Authentication**: Supabase Auth (JWT)
- **Deployment**: Docker Compose / Supabase
- **Optional Agents**: Celery workers, LangChain, or cron jobs
- **Vector Search**: `pgvector` or external (Weaviate, Qdrant)
- **Messaging (Optional)**: Redis Streams, NATS

---

## ğŸ—‚ï¸ Microservices

---

### 1. Auth Service

**Responsibility**: Authentication, JWT, sessions, email verification  
**Agentic?** âŒ

**Endpoints**
- `POST /auth/signup`
- `POST /auth/login`
- `POST /auth/logout`
- `POST /auth/verify-email`
- `POST /auth/reset-password`

---

### 2. User Profile Service

**Responsibility**: Personal and demographic data  
**Agentic?** âŒ

**Endpoints**
- `GET /me/profile`
- `PUT /me/profile`

---

### 3. Health Tracking Service

**Responsibility**: Vitals, symptoms, goals, metrics  
**Agentic?** âœ…  
> Suggests goals, monitors changes, detects deviations

**Endpoints**
- `GET /me/vitals`
- `POST /me/vitals`
- `GET /me/symptoms`
- `POST /me/symptoms`
- `GET /me/goals`
- `POST /me/goals`

---

### 4. Device Data Service

**Responsibility**: Wearables, sensors, sync  
**Agentic?** âœ…  
> Flags missing or corrupt data

**Endpoints**
- `GET /devices`
- `POST /devices`
- `POST /devices/{id}/sync`

---

### 5. Activity & Sleep Service

**Responsibility**: Physical and sleep tracking  
**Agentic?** âœ…  
> Detects sleep debt, inactivity trends

**Endpoints**
- `GET /me/activity`
- `POST /me/activity`
- `GET /me/sleep`
- `POST /me/sleep`

---

### 6. Nutrition Service

**Responsibility**: Meals, analysis, supplements  
**Agentic?** âœ…  
> AI photo analysis, imbalance warnings

**Endpoints**
- `GET /me/nutrition/logs`
- `POST /me/nutrition/logs`
- `POST /me/nutrition/photos`
- `GET /me/supplements`
- `POST /me/supplements`
- `POST /me/supplements/logs`

---

### 7. Medical Records Service

**Responsibility**: Lab results, imaging, reports  
**Agentic?** âŒ  
> Static by default (but used by agents)

**Endpoints**
- `GET /me/reports`
- `POST /me/reports`
- `GET /me/images`
- `POST /me/images`
- `GET /me/labs`
- `POST /me/labs`

---

### 8. Doctor Collaboration Service

**Responsibility**: Provider linkage, annotation  
**Agentic?** âœ…  
> Generates summaries, flags priorities

**Endpoints**
- `GET /providers`
- `POST /providers/connect`
- `GET /me/providers`
- `POST /providers/annotate`

---

### 9. AI Insights Service

**Responsibility**: User-specific health insights  
**Agentic?** âœ…  
> Detects risk, sends recommendations

**Endpoints**
- `GET /me/insights`
- `GET /me/analytics/daily`
- `GET /me/alerts`

---

### 10. Explainability Service

**Responsibility**: Cause-effect inference  
**Agentic?** âœ…  
> "Why did this happen?" answers

**Endpoints**
- `GET /me/events`
- `GET /me/causes`

---

### 11. Voice & Input Processing Service

**Responsibility**: Voice, OCR, raw inputs  
**Agentic?** âœ…  
> Converts voice to health logs or commands

**Endpoints**
- `POST /me/voice`
- `GET /me/voice`

---

### 12. Genomics Service

**Responsibility**: Gene variants and health links  
**Agentic?** âœ…  
> Generates long-term risk profiles

**Endpoints**
- `GET /me/genomics`
- `POST /me/genomics`

---

### 13. Medical Knowledge Graph Service

**Responsibility**: Semantic search, drug/food interactions  
**Agentic?** âœ…  
> Learns from new research, adapts interactions

**Endpoints**
- `GET /search?q=term`
- `GET /interactions`

---

### 14. Consent & Audit Service

**Responsibility**: Privacy controls, audit logs  
**Agentic?** âŒ

**Endpoints**
- `GET /me/consents`
- `POST /me/consents`
- `GET /me/audit-logs`

---

## ğŸ¤– Agentic System Overview

| Domain | Intelligent Behavior |
|--------|----------------------|
| Health Tracking | Suggest goals, detect anomalies |
| Nutrition | AI photo classification, warn on imbalances |
| Sleep | Detect poor sleep patterns |
| Medical | Auto-generate summaries for doctors |
| Explainability | Causal graphs, personalized insights |
| Genomics | Gene-to-risk interpretation |
| Knowledge | Auto-updated interactions via literature embeddings |

---

## ğŸ” Service Communication

| Source | Destination | Purpose |
|--------|-------------|---------|
| Nutrition â†’ AI | Analyze food |
| Health â†’ Insights | Flag anomalies |
| Device â†’ Analytics | Generate reports |
| Explainability â†’ Doctor | Causal timelines |
| Knowledge â†’ Insights | Suggest new risks |

---

## ğŸš€ Developer Notes

- Use `auth.uid()` or JWT tokens for user context
- Store logs/events in `event_logs`
- Store vectors using `pgvector`
- All POSTs must validate user identity via middleware
- Each service has its own schema or database

---

## ğŸ“Œ TODO (Future Expansion)

- Add **Notifications Service**
- Add **Scheduler Agent**
- Add **Billing Service**
- Add **Research API Gateway**

---

## ğŸ“ Contact

For technical support or questions:  
**tech@vitasense.ai**  
**Engineering Slack: `#backend-dev`**

